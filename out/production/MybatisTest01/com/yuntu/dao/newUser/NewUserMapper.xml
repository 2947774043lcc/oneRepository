<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yuntu.dao.newUser.NewUserMapper">
    <!--
    if元素用于实现简单的条件判断  来防止参数为null时,导致检索结果为null
    -->
    <!--<select id="getUserList" resultType="User">
        SELECT
            u.*,
            r.roleName
        FROM
            smbms_user u,
            smbms_role r
        WHERE
            u.userRole = r.id
          <if test="userRole != null">
          AND u.userRole = #{userRole}
          </if>
          <if test="userName != null and userName != ''">
          AND u.userName LIKE CONCAT('%',#{userName},'%')
          </if>
    </select>-->
    <!--<select id="getUserList" resultType="User">
        select * from smbms_user
        <where>
            <if test="userRole != null">
                AND userRole = #{userRole}
            </if>
            <if test="userName != null and userName != ''">
                AND userName LIKE CONCAT('%',#{userName},'%')
            </if>
        </where>
    </select>-->

<!--    <resultMap id="userList" type="com.yuntu.pojo.User">-->
<!--        <id property="id" column="id"/>-->
<!--        <result property="userCode" column="userCode"/>-->
<!--        <result property="userName" column="userName"/>-->
<!--    </resultMap>-->


    <select id="getUserList" resultType="User">
        select * from smbms_user
        <trim prefix="where" prefixOverrides="and|or">
            <if test="userRole != null">
                AND userRole = #{userRole}
            </if>
            <if test="userName != null and userName != ''">
                AND userName LIKE CONCAT('%',#{userName},'%')
            </if>
        </trim>
    </select>

    <!--
    set标签  若某个参数为null,则不需要更新,保留原值即可
    -->
   <!-- <update id="modify" parameterType="User">
        update smbms_user
        <set>
            <if test="userCode!=null"> userCode = #{userCode},</if>
            <if test="userName!=null"> userName = #{userName},</if>
            <if test="userPassword!=null"> userPassword = #{userPassword},</if>
            <if test="gender!=null"> gender = #{gender},</if>
            <if test="birthday!=null"> birthday = #{birthday},</if>
            <if test="phone!=null"> phone = #{phone},</if>
            <if test="address!=null"> address = #{address},</if>
            <if test="userRole!=null"> userRole = #{userRole},</if>
            <if test="createdBy!=null"> createdBy = #{createdBy},</if>
            <if test="creationDate!=null"> creationDate = #{creationDate},</if>
            where id=#{id}
        </set>
    </update>-->
    <update id="modify" parameterType="User">
        update smbms_user
        <trim prefix="set" suffixOverrides="," suffix="where id=#{id}">
            <if test="userCode!=null"> userCode = #{userCode},</if>
            <if test="userName!=null"> userName = #{userName},</if>
            <if test="userPassword!=null"> userPassword = #{userPassword},</if>
            <if test="gender!=null"> gender = #{gender},</if>
            <if test="birthday!=null"> birthday = #{birthday},</if>
            <if test="phone!=null"> phone = #{phone},</if>
            <if test="address!=null"> address = #{address},</if>
            <if test="userRole!=null"> userRole = #{userRole},</if>
            <if test="createdBy!=null"> createdBy = #{createdBy},</if>
            <if test="creationDate!=null"> creationDate = #{creationDate},</if>
        </trim>
    </update>
    <!--<insert id="add" parameterType="User">
        insert into smbms_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userCode!=null and userCode!=''">userCode,</if>
            <if test="userName!=null and userName!=''">userName,</if>
            <if test="userPassword!=null and userPassword!=''">userPassword,</if>
            <if test="gender!=null and gender!=''">gender,</if>
            <if test="birthday!=null and birthday!=''">birthday,</if>
            <if test="phone!=null and phone!=''">phone,</if>
            <if test="address!=null and address!=''">address,</if>
            <if test="userRole!=null and userRole!=''">userRole,</if>
            <if test="createdBy!=null and createdBy!=''">createdBy,</if>
            <if test="creationDate!=null and creationDate!=''">creationDate,</if>
        </trim>
        <trim prefix="values(" suffix=")" suffixOverrides=",">
            <if test="userCode!=null and userCode!=''">#{userCode},</if>
            <if test="userName!=null and userName!=''">#{userName},</if>
            <if test="userPassword!=null and userPassword!=''">#{userPassword},</if>
            <if test="gender!=null and gender!=''">#{gender},</if>
            <if test="birthday!=null and birthday!=''">#{birthday},</if>
            <if test="phone!=null and phone!=''">#{phone},</if>
            <if test="address!=null and address!=''">#{address},</if>
            <if test="userRole!=null and userRole!=''">#{userRole},</if>
            <if test="createdBy!=null and createdBy!=''">#{createdBy},</if>
            <if test="creationDate!=null and creationDate!=''">#{creationDate},</if>
        </trim>
    </insert>-->

    <insert id="add1" parameterType="User">
        insert into smbms_user(userCode,userName,userPassword,gender,birthday,phone,
        address,userRole,createdBy,creationDate)
        <foreach collection="userList" item="userList" open="values" separator=",">
            <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userList.userCode!=null and userList.userCode!=''">#{userList.userCode},</if>
            <if test="userList.userName!=null and userList.userName!=''">#{userList.userName},</if>
            <if test="userList.userPassword!=null and userList.userPassword!=''">#{userList.userPassword},</if>
            <if test="userList.gender!=null and userList.gender!=''">#{userList.gender},</if>
            <if test="userList.birthday!=null and userList.birthday!=''">#{userList.birthday},</if>
            <if test="userList.phone!=null and userList.phone!=''">#{userList.phone},</if>
            <if test="userList.address!=null and userList.address!=''">#{userList.address},</if>
            <if test="userList.userRole!=null and userList.userRole!=''">#{userList.userRole},</if>
            <if test="userList.createdBy!=null and userList.createdBy!=''">#{userList.createdBy},</if>
            <if test="userList.creationDate!=null and userList.creationDate!=''">#{userList.creationDate},</if>
            </trim>
        </foreach>
    </insert>



    <resultMap id="userList" type="User">
        <id property="id" column="id"/>
        <result property="userCode" column="userCode"/>
        <result property="userName" column="userName"/>
    </resultMap>
    <select id="getUserByRoleId_array" resultMap="userList">
         select * from smbms_user where userRole in
        <foreach collection="array" item="roleIds" open="(" close=")" separator=",">
            #{roleIds}
        </foreach>
    </select>
    <select id="getUserByRoleId_list" resultMap="userList">
        select * from smbms_user where userRole in
        <foreach collection="list" item="roleList" open="(" close=")" separator=",">
            #{roleIds}pp
        </foreach>
    </select>
    <select id="getUserByRoleId_Map" resultMap="userList">
        select * from smbms_user where userRole in
        <foreach collection="roleMap.keys" item="key" open="(" close=")" separator=",">
            #{key}
        </foreach>
    </select>
    <delete id="deleteUser">
    delete from smbms_user
        <where>
        <if test="ids!=null">
        <foreach collection="ids" item="ids" open="id in(" close=")" separator=",">
            #{ids}
        </foreach>
        </if>
        </where>
    </delete>

    <insert id="addForList" parameterType="List">
        insert into smbms_user(userCode,userName,userPassword,gender,birthday,phone,
                               address,userRole,createdBy,creationDate)
        <foreach collection="list" item="users" open="values"  separator=",">
            (#{user.userName},#{user.userPassword},#{user.gender},#{user.phone},
            #{user.address},#{user.userRole},#{user.createdBy},#{user.creationDate})
        </foreach>
    </insert>

    <update id="updateForList" parameterType="List">
        <foreach collection="list" item="user" open="" close="" separator=";">
            update smbms_user
            <trim prefix="set" suffixOverrides=",">
                <if test="user.userCode!=null and user.userCode!=''">
                    userCode=#{user.userCode},
                </if>
                <if test="user.userName!=null and user.userName!=''">
                    userName=#{user.userName},
                </if>
            </trim>
            where id = #{user.id}
        </foreach>
    </update>

    <select id="getUserList_chose" resultMap="userList">
        select id,userName, userCode from smbms_user
       <where>
           <choose>
               <when test="userCode != null and userCode != ''">
                   and userCode = #{userCode}
               </when>
               <when test="userName != null and userName != ''">
                   and userName like CONCAT('%',#{userName},'%')
               </when>
               <when test="userRole != null">
                   and userRole = #{userRole}
               </when>
               <otherwise>
                   and YEAR(createDate) = YEAR(#{createDate})
               </otherwise>
           </choose>
       </where>
    </select>

    <select id="selectAll"  resultType="com.yuntu.pojo.User">
        select * from smbms_user
    </select>

    <select id="getUserListByLimit" resultMap="userList">
        select u.userName,u.userCode from smbms_user u,smbms_role r where
        u.userRole = r.id
        <if test="roleId!=null">
            and u.userRole = ${roleId}
        </if>
        <if test="userName != null and userName != ''">
            and u.userName like CONCAYT('%',#{userName},'%')
        </if>
        order by u.creationDate DESC limit #{currentPageNo},#{pageSize}
    </select>
</mapper>